(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function d(e,t){Object.defineProperty(this,"_id",{value:d.nextID++}),this.name=e,this.type=t}d.nextID=0;function v(e){let t=new c(e.name);return e.children.map(i=>{if(i.type==="f")return F(i);if(i.type==="d")return v(i)}).forEach(i=>t.add(i)),t}function F(e){return new h(e.name,e.content)}d.deserialize=function(e){return e?v(e):new c("")};d.prototype.getPath=function(){let e="",t=this;for(;t;)e=t.name+"/"+e,t=t.parent;return e};function c(e){d.call(this,e,"d"),this.children=[]}c.prototype=new d;c.prototype.get=function(e){return this.children.find(t=>t.name===e)};c.prototype.exists=function(e){return!!this.get(e)};c.prototype.add=function(e){return this.exists(e.name)||e.parent?!1:(Object.defineProperty(e,"parent",{value:this}),this.children.push(e),!0)};c.prototype.remove=function(e){let t=this.children.findIndex(n=>n._id===e._id);t>-1&&this.children.splice(t,1)};function h(e,t){d.call(this,e,"f"),this.content=t||""}h.prototype=new d;h.prototype.erase=function(){this.content=""};h.prototype.write=function(e){this.content=e};h.prototype.append=function(e){this.write(this.content+e)};const a={dirname:e=>e.substr(0,e.lastIndexOf("/"))||"/",basename:e=>e.substr(e.lastIndexOf("/")+1),join:(e,t)=>e+(e.endsWith("/")?"":"/")+t};function l(e,t){this.root=e||new c(""),this.pwd=t||"/",(!this.exists(this.pwd)||this.get(this.pwd).type!=="d")&&(this.pwd="/")}l.deserialize=function(e){return e?new l(d.deserialize(e.root),e.pwd):new l};l.prototype._resolve=function(e){let t=e,n=this.pwd;if(t===".")return n;if(t==="..")return a.dirname(n);for(t.startsWith("./")&&(t=t.substr(2));t.startsWith("../");)t=t.substr(3),n=a.dirname(n);return t.startsWith("/")||(t=a.join(n,t)),t};l.prototype.get=function(e){let n=this._resolve(e).substr(1).split("/"),i=this.root;for(;n.length;){let r=n.shift();if(r&&(i=i.get(r),!i||n.length>0&&i.type!=="d"))return}return i};l.prototype.exists=function(e){return!!this.get(e)};l.prototype.touch=function(e){if(this.exists(e))return;let t=this.get(a.dirname(this._resolve(e)));!t||!t.type==="d"||t.add(new h(a.basename(e)))};l.prototype.mkdir=function(e){if(this.exists(e))return;let t=this.get(a.dirname(this._resolve(e)));!t||!t.type==="d"||t.add(new c(a.basename(e)))};l.prototype.readDir=function(e){let t=this.get(e);if(!(!t||t.type!=="d"))return t.children};l.prototype.readFile=function(e){let t=this.get(e);if(!(!t||t.type!=="f"))return t.content};l.prototype.writeFile=function(e,t){let n=this.get(e);!n||n.type!=="f"||n.write(t)};l.prototype.appendFile=function(e,t){let n=this.get(e);!n||n.type!=="f"||n.append(t)};l.prototype.delete=function(e){let t=this.get(e);!t||!t.parent||t.parent.remove(t)};const N=e=>document.querySelector(e),x={default:["output-item"],error:["output-item","output-item-error"]},w=N(".commandOutput"),O=e=>t=>{const n=document.createElement("div");n.classList.add(...e),n.innerText=t+`
`,w.appendChild(n),w.scrollTop=w.scrollHeight},b=O(x.default),L=O(x.error);let s,m,y={};window.addEventListener("load",function(){s=JSON.parse(localStorage.getItem("sys")||"{}"),s.fs=l.deserialize(s.fs),m=document.querySelector(".commandInput"),m.focus(),document.addEventListener("keydown",e=>{e.keyCode===13&&(I(m.value),m.value="")})});window.addEventListener("unload",function(){localStorage.setItem("sys",JSON.stringify(s))});function I(e){b(`$ ${e}`);let t=e.split(" "),n=t[0].toLowerCase(),i=t.slice(1),r=y[n],o;if(r)try{let f=r(i);f!==void 0&&b(`${f}`)}catch(f){o=f}else o="Unknown command: "+n;o&&L(o)}function u(e,t,n){let i=[].concat(e).map(r=>r.toLowerCase());n.description=t,i.forEach(r=>y[r]=n)}function p(e,t,n){if(e.length<t)throw"Usage: "+n}function g(e){return e.map(t=>parseInt(t)).filter(t=>!isNaN(t))}u(["add","+"],"adds two or more numbers",e=>g(e).reduce((t,n)=>t+n,0));u(["subtract","-"],"subtracts two or more numbers",e=>{let t=g(e),n=t.shift();return t.reduce((i,r)=>i-r,n)});u(["multiply","*"],"multiplies two or more numbers",e=>g(e).reduce((t,n)=>t*n,1));u("cd","changes the current working directory to a different folder",e=>{p(e,1,"cd <folder>");let t=s.fs._resolve(e[0]),n=s.fs.get(t);if(n&&n.type==="d")s.fs.pwd=t;else throw'The folder "'+t+'" does not exist!';return t});u("pwd","shows the current working directory",()=>s.fs.pwd||"/");u("ls","lists all files in the current directory",e=>s.fs.readDir(e[0]||"").map(t=>t.name+(t.type==="d"?"/":"")).join(`
`));u("touch","creates or updates the timestamp for the given file",e=>p(e,1,"touch <file>")||s.fs.touch(e[0]));u("mkdir","makes a new directory",e=>p(e,1,"mkdir <folder>")||s.fs.mkdir(e[0]));u("cat","outputs the contents of a file",e=>p(e,1,"cat <file>")||s.fs.readFile(e[0]));u("write","writes the given contents to a file",e=>p(e,1,"write <file> [contents]")||s.fs.writeFile(e[0],e.slice(1).join(" ")+`
`));u("append","appends the given contents to a file",e=>p(e,1,"append <file> [contents]")||s.fs.appendFile(e[0],e.slice(1).join(" ")+`
`));u("rm","removes a file",e=>p(e,1,"rm <path>")||s.fs.delete(e[0]));u("help","shows a list of all commands",()=>{let e=Object.keys(y).sort(),t=e.reduce((n,i)=>Math.max(n,i.length),0);return e.map(n=>`${n}${" ".repeat(t-n.length)} : ${y[n].description}`).join(`
`)});
